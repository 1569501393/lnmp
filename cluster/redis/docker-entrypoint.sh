#!/bin/sh

if [ -z "$1" ];then

until nc -z -w 1 172.16.0.102 7002 \
  && nc -z -w 1 172.16.0.103:7003 \
  && nc -z -w 1 172.16.0.201:8001 \
  && nc -z -w 1 172.16.0.202:8002 \
  && nc -z -w 1 172.16.0.203:8003 \
  ; do
  echo "wait"
done

exec redis-trib.rb create --replicas 1 \
      172.16.0.101:6379 \
      172.16.0.102:7002 \
      172.16.0.103:7003 \
      172.16.0.201:8001 \
      172.16.0.202:8002 \
      172.16.0.203:8003

fi

exec "$@"
